# Dockerfile.wasm-translator
# LLVM 18, Binaryen 118, node 20
FROM emscripten/emsdk:3.1.71     

# ---------- build-time deps ----------
RUN apt-get update && \
    apt-get install -y git ninja-build cmake && \
    rm -rf /var/lib/apt/lists/*

# pull ANGLE
WORKDIR /opt
ARG ANGLE_REF=main
RUN git clone https://chromium.googlesource.com/angle/angle.git && \
    cd angle && git checkout ${ANGLE_REF}

# copy *only* your CMakeLists.txt and extra stubs
COPY CMakeLists.txt    /opt/angle/CMakeLists.txt
COPY src/common/system_utils_emscripten.cpp /opt/angle/src/common/